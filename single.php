<?php
/**
 * Template Name: Blog Detail
 * 
 * The template for displaying individual blog posts.
 *
 * @link https://developer.wordpress.org/themes/basics/template-hierarchy/
 *
 * @package buy-my-property
 */

get_header();
?>

<main id="primary" class="site-main mt_default">

    <?php get_template_part( 'template-parts/banner' ); ?>
    <section class="blog_detail_content wrap pt_100 pb_120">
        <div class="blog-detail-container">
            <article class="blog-detail-article">
                <!-- Blog Meta -->
                <div class="blog-detail-meta">
                    <span class="badge bg-primary"><?php echo get_the_category()[0]->name; ?></span>
                    <span class="badge bg-off-white"><?php echo get_the_date('M d, Y'); ?></span>
                </div>

                <!-- Blog Title -->
                <h1 class="blog-detail-title heading-medium-primary">
                    <?php the_title(); ?>
                </h1>

                <!-- Blog Content -->
                <div class="blog-detail-body">
                    <div class="blog-content">
                        <?php the_content(); ?>
                
                    </div>

                    <!-- Share Section -->
                    <div class="blog-share-section">
                        <span class="share-label">Share this</span>
                        <div class="share-buttons">
                                <?php 
                $post_url   = urlencode(get_permalink());
                $post_title = urlencode(get_the_title());
                $whatsapp_link = "https://wa.me/?text={$post_title}%20{$post_url}";

                ?>
                       <a href="https://www.facebook.com/sharer/sharer.php?u=<?php echo $post_url; ?>" target="_blank" class="social-link_blog" aria-label="Facebook">
                                <svg width="11" height="21" viewBox="0 0 11 21" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M8.94276 3.56295H10.8951V0.26065C9.94981 0.162357 9.00004 0.113828 8.04969 0.115265C5.22508 0.115265 3.29354 1.83911 3.29354 4.99603V7.71679H0.105469V11.4137H3.29354V20.8845H7.11507V11.4137H10.2928L10.7705 7.71679H7.11507V5.35949C7.11507 4.26911 7.40584 3.56295 8.94276 3.56295Z"
                                        fill="black" />
                                </svg>

                            </a>
                            <a href="https://www.linkedin.com/shareArticle?mini=true&url=<?php echo $post_url; ?>&title=<?php echo $post_title; ?>" target="_blank" class="social-link_blog" aria-label="LinkedIn">
                                <svg width="21" height="21" viewBox="0 0 21 21" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M16.0455 3.70856C15.799 3.70856 15.5581 3.78164 15.3532 3.91857C15.1482 4.0555 14.9885 4.25012 14.8942 4.47783C14.7999 4.70553 14.7752 4.95609 14.8233 5.19782C14.8714 5.43955 14.99 5.66159 15.1643 5.83587C15.3386 6.01015 15.5606 6.12883 15.8024 6.17692C16.0441 6.225 16.2947 6.20032 16.5224 6.106C16.7501 6.01169 16.9447 5.85196 17.0816 5.64704C17.2185 5.44211 17.2916 5.20117 17.2916 4.95471C17.2916 4.62421 17.1603 4.30724 16.9266 4.07355C16.6929 3.83985 16.376 3.70856 16.0455 3.70856ZM20.8224 6.22163C20.8022 5.36002 20.6408 4.50755 20.3447 3.69817C20.0807 3.00565 19.6697 2.37858 19.1401 1.86009C18.6259 1.32781 17.9973 0.919431 17.302 0.665863C16.4948 0.360722 15.6414 0.195658 14.7786 0.177786C13.6778 0.115478 13.3247 0.115479 10.5001 0.115479C7.67548 0.115479 7.3224 0.115478 6.22163 0.177786C5.35883 0.195658 4.50541 0.360722 3.69817 0.665863C3.00414 0.921998 2.37614 1.33002 1.86009 1.86009C1.32781 2.37432 0.919431 3.00286 0.665863 3.69817C0.360722 4.50541 0.195658 5.35883 0.177786 6.22163C0.115478 7.3224 0.115479 7.67548 0.115479 10.5001C0.115479 13.3247 0.115478 13.6778 0.177786 14.7786C0.195658 15.6414 0.360722 16.4948 0.665863 17.302C0.919431 17.9973 1.32781 18.6259 1.86009 19.1401C2.37614 19.6702 3.00414 20.0782 3.69817 20.3343C4.50541 20.6395 5.35883 20.8045 6.22163 20.8224C7.3224 20.8847 7.67548 20.8847 10.5001 20.8847C13.3247 20.8847 13.6778 20.8847 14.7786 20.8224C15.6414 20.8045 16.4948 20.6395 17.302 20.3343C17.9973 20.0808 18.6259 19.6724 19.1401 19.1401C19.672 18.6235 20.0834 17.9959 20.3447 17.302C20.6408 16.4926 20.8022 15.6402 20.8224 14.7786C20.8224 13.6778 20.8847 13.3247 20.8847 10.5001C20.8847 7.67548 20.8847 7.3224 20.8224 6.22163ZM18.9532 14.6539C18.9456 15.3131 18.8262 15.9662 18.6001 16.5855C18.4343 17.0374 18.168 17.4458 17.8212 17.7797C17.4844 18.1229 17.0769 18.3887 16.627 18.5586C16.0078 18.7847 15.3547 18.9041 14.6955 18.9116C13.657 18.9636 13.2728 18.9739 10.5416 18.9739C7.81048 18.9739 7.42625 18.9739 6.38779 18.9116C5.70333 18.9244 5.02179 18.8191 4.37317 18.6001C3.94302 18.4216 3.55419 18.1564 3.23086 17.8212C2.88619 17.4876 2.6232 17.0789 2.4624 16.627C2.20887 15.9989 2.06825 15.331 2.04702 14.6539C2.04702 13.6155 1.98471 13.2312 1.98471 10.5001C1.98471 7.76894 1.98471 7.38471 2.04702 6.34625C2.05167 5.67234 2.1747 5.0045 2.41048 4.37317C2.5933 3.93485 2.87391 3.54412 3.23086 3.23086C3.54636 2.87381 3.93628 2.59023 4.37317 2.40009C5.00617 2.17168 5.67332 2.05229 6.34625 2.04702C7.38471 2.04702 7.76894 1.98471 10.5001 1.98471C13.2312 1.98471 13.6155 1.98471 14.6539 2.04702C15.3131 2.05458 15.9662 2.17396 16.5855 2.40009C17.0574 2.57523 17.4809 2.85997 17.8212 3.23086C18.1616 3.54986 18.4275 3.93985 18.6001 4.37317C18.8309 5.00552 18.9504 5.6731 18.9532 6.34625C19.0051 7.38471 19.0155 7.76894 19.0155 10.5001C19.0155 13.2312 19.0051 13.6155 18.9532 14.6539ZM10.5001 5.17279C9.4469 5.17484 8.41794 5.48902 7.54323 6.07564C6.66853 6.66226 5.98733 7.49499 5.58571 8.46861C5.18409 9.44222 5.08008 10.513 5.2868 11.5458C5.49353 12.5785 6.00172 13.5267 6.74717 14.2707C7.49262 15.0147 8.44187 15.5211 9.47499 15.7258C10.5081 15.9305 11.5787 15.8244 12.5515 15.4209C13.5244 15.0174 14.3558 14.3345 14.9407 13.4587C15.5256 12.5829 15.8378 11.5533 15.8378 10.5001C15.8392 9.79924 15.702 9.10503 15.4341 8.45739C15.1662 7.80976 14.7729 7.22147 14.2768 6.72638C13.7808 6.23128 13.1917 5.83914 12.5436 5.57252C11.8954 5.3059 11.2009 5.17005 10.5001 5.17279ZM10.5001 13.9582C9.81615 13.9582 9.14757 13.7554 8.57889 13.3754C8.01021 12.9954 7.56698 12.4553 7.30525 11.8234C7.04351 11.1916 6.97503 10.4963 7.10846 9.82546C7.24189 9.15465 7.57124 8.53848 8.05486 8.05486C8.53848 7.57124 9.15465 7.24189 9.82546 7.10846C10.4963 6.97503 11.1916 7.04351 11.8234 7.30525C12.4553 7.56698 12.9954 8.01021 13.3754 8.57889C13.7554 9.14757 13.9582 9.81615 13.9582 10.5001C13.9582 10.9542 13.8687 11.4039 13.6949 11.8234C13.5212 12.243 13.2664 12.6242 12.9453 12.9453C12.6242 13.2664 12.243 13.5212 11.8234 13.6949C11.4039 13.8687 10.9542 13.9582 10.5001 13.9582Z"
                                        fill="black" />
                                </svg>

                            </a>
                         <a href="https://twitter.com/intent/tweet?url=<?php echo $post_url; ?>&text=<?php echo $post_title; ?>" target="_blank" class="social-link_blog" aria-label="Twitter">
                                <svg width="17" height="19" viewBox="0 0 17 19" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M10.1175 8.16L16.4463 0.75H14.9463L9.4525 7.18375L5.0625 0.75H0L6.6375 10.48L0 18.25H1.5L7.3025 11.455L11.9388 18.25H17.0013L10.1175 8.16ZM8.06375 10.565L7.39125 9.59625L2.04 1.8875H4.34375L8.66125 8.10875L9.33375 9.0775L14.9475 17.165H12.6438L8.06375 10.565Z"
                                        fill="black" />
                                </svg>

                            </a>
                            <a href="<?php echo $whatsapp_link; ?>" target="_blank" class="social-link_blog" aria-label="whatsapp">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M17.0508 2.91006C16.134 1.98399 15.042 1.24973 13.8384 0.750111C12.6349 0.250494 11.3439 -0.00448012 10.0408 5.95696e-05C4.58078 5.95696e-05 0.130781 4.45006 0.130781 9.91006C0.130781 11.6601 0.590781 13.3601 1.45078 14.8601L0.0507812 20.0001L5.30078 18.6201C6.75078 19.4101 8.38078 19.8301 10.0408 19.8301C15.5008 19.8301 19.9508 15.3801 19.9508 9.92006C19.9508 7.27006 18.9208 4.78006 17.0508 2.91006ZM10.0408 18.1501C8.56078 18.1501 7.11078 17.7501 5.84078 17.0001L5.54078 16.8201L2.42078 17.6401L3.25078 14.6001L3.05078 14.2901C2.22853 12.977 1.79192 11.4593 1.79078 9.91006C1.79078 5.37006 5.49078 1.67006 10.0308 1.67006C12.2308 1.67006 14.3008 2.53006 15.8508 4.09006C16.6183 4.85402 17.2265 5.76272 17.6402 6.76348C18.0539 7.76425 18.2648 8.83717 18.2608 9.92006C18.2808 14.4601 14.5808 18.1501 10.0408 18.1501ZM14.5608 11.9901C14.3108 11.8701 13.0908 11.2701 12.8708 11.1801C12.6408 11.1001 12.4808 11.0601 12.3108 11.3001C12.1408 11.5501 11.6708 12.1101 11.5308 12.2701C11.3908 12.4401 11.2408 12.4601 10.9908 12.3301C10.7408 12.2101 9.94078 11.9401 9.00078 11.1001C8.26078 10.4401 7.77078 9.63006 7.62078 9.38006C7.48078 9.13006 7.60078 9.00006 7.73078 8.87006C7.84078 8.76006 7.98078 8.58006 8.10078 8.44006C8.22078 8.30006 8.27078 8.19006 8.35078 8.03006C8.43078 7.86006 8.39078 7.72006 8.33078 7.60006C8.27078 7.48006 7.77078 6.26006 7.57078 5.76006C7.37078 5.28006 7.16078 5.34006 7.01078 5.33006H6.53078C6.36078 5.33006 6.10078 5.39006 5.87078 5.64006C5.65078 5.89006 5.01078 6.49006 5.01078 7.71006C5.01078 8.93006 5.90078 10.1101 6.02078 10.2701C6.14078 10.4401 7.77078 12.9401 10.2508 14.0101C10.8408 14.2701 11.3008 14.4201 11.6608 14.5301C12.2508 14.7201 12.7908 14.6901 13.2208 14.6301C13.7008 14.5601 14.6908 14.0301 14.8908 13.4501C15.1008 12.8701 15.1008 12.3801 15.0308 12.2701C14.9608 12.1601 14.8108 12.1101 14.5608 11.9901Z"
                                        fill="black" />
                                </svg>

                            </a>
                        </div>
                    </div>
                </div>
            </article>
        </div>
    </section>

    <section class="latest_articles_section wrap pb_110">
    <div class="section-header">
        <h2 class="heading-medium-primary">Latest articles</h2>

        <a href="<?php echo get_permalink('26');?>" class="btn-primary view_all">
            View All
            <svg width="9" height="9" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M4.88452 0.880798L9.19988 5.00001L4.88452 9.11922" stroke="white" stroke-width="1.28571"
                    stroke-linecap="round" stroke-linejoin="round" />
                <path d="M9.2 4.99994L0.800049 4.99994" stroke="white" stroke-width="1.28571" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
        </a>
    </div>

    <div class="articles-grid">
        <?php
        // Query latest 3 posts excluding the current one
        $args = array(
            'post_type'      => 'post',
            'posts_per_page' => 3,
            'post__not_in'   => array( get_the_ID() ),
            'orderby'        => 'date',
            'order'          => 'DESC',
        );
        $latest_posts = new WP_Query( $args );

        if ( $latest_posts->have_posts() ) :
            while ( $latest_posts->have_posts() ) : $latest_posts->the_post();
                $categories = get_the_category();
                $category_name = !empty($categories) ? esc_html($categories[0]->name) : 'Uncategorized';
                $featured_img = get_the_post_thumbnail_url( get_the_ID(), 'medium' );
                if ( !$featured_img ) {
                    $featured_img = get_template_directory_uri() . '/assets/images/blog/default.png'; // fallback
                }
        ?>
            <article class="article-card">
                <div class="article-image">
                    <a href="<?php the_permalink(); ?>">
                        <img src="<?php echo esc_url($featured_img); ?>" alt="<?php the_title_attribute(); ?>" loading="lazy">
                    </a>
                </div>
                <div class="article-content">
                    <div class="article-meta">
                        <span class="badge bg-primary"><?php echo $category_name; ?></span>
                        <span class="badge bg-off-white"><?php echo get_the_date('M d, Y'); ?></span>
                    </div>
                    <h3 class="article-title">
                        <a href="<?php the_permalink(); ?>"><?php the_title(); ?></a>
                    </h3>
                    <p class="article-description"><?php echo wp_trim_words( get_the_excerpt(), 25, '...' ); ?></p>
                </div>
            </article>
        <?php
            endwhile;
            wp_reset_postdata();
        else :
            echo '<p>No articles found.</p>';
        endif;
        ?>
    </div>
</section>


</main>

<?php get_footer(); ?>